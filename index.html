<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConsumptionPulse | Global Observatory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body class="bg-[#0b1121] text-slate-300 min-h-screen pb-20">

    <nav class="border-b border-slate-800 bg-[#0b1121]/90 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 bg-emerald-500 rounded-full animate-pulse"></div>
                <span class="font-bold text-white tracking-tight">Consumption<span class="text-emerald-500">Pulse</span></span>
            </div>
            <div id="lastUpdated" class="text-xs font-mono text-slate-500">SYSTEM LOADING...</div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-6 py-8">

        <div class="grid lg:grid-cols-12 gap-6 mb-8">
            <div class="lg:col-span-4 glass rounded-xl p-6">
                <h2 class="text-emerald-400 text-xs font-bold uppercase tracking-widest mb-6">Comparative Analysis</h2>
                <div class="space-y-4">
                    <div>
                        <label class="text-xs text-slate-400">Baseline Nation</label>
                        <select id="countryA" onchange="updateComparison()" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:outline-none focus:border-emerald-500 transition-colors"></select>
                    </div>
                    <div class="flex justify-center"><span class="text-xs font-mono text-slate-600">VS</span></div>
                    <div>
                        <label class="text-xs text-slate-400">Target Nation</label>
                        <select id="countryB" onchange="updateComparison()" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:outline-none focus:border-emerald-500 transition-colors"></select>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8 glass rounded-xl p-6 flex flex-col justify-center">
                <div id="scorecard" class="space-y-6">
                    <div class="text-center text-slate-500 animate-pulse">Initializing Neural Link...</div>
                </div>
            </div>
        </div>

        <div class="glass rounded-xl p-6">
            <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                <h3 class="text-white font-semibold">Global Metrics Explorer</h3>
                <div class="flex bg-slate-900 rounded-lg p-1">
                    <button onclick="switchChart('energy')" class="px-4 py-1.5 text-xs font-medium rounded-md text-white bg-slate-700 shadow-sm transition-all" id="btn-energy">Energy</button>
                    <button onclick="switchChart('co2')" class="px-4 py-1.5 text-xs font-medium rounded-md text-slate-400 hover:text-white transition-all" id="btn-co2">CO₂</button>
                    <button onclick="switchChart('gdp')" class="px-4 py-1.5 text-xs font-medium rounded-md text-slate-400 hover:text-white transition-all" id="btn-gdp">GDP</button>
                </div>
            </div>
            <div class="relative h-80 w-full">
                <canvas id="mainChart"></canvas>
            </div>
        </div>

    </main>

    <script>
        let globalData = [];
        let chartInstance = null;

        // Colors
        const THEME = {
            energy: { color: '#10b981', label: 'Energy Use (kg oil/capita)' }, // Emerald
            co2:    { color: '#f59e0b', label: 'CO₂ Emissions (tons/capita)' }, // Amber
            gdp:    { color: '#3b82f6', label: 'GDP per Capita (USD)' }         // Blue
        };

        async function init() {
            try {
                const res = await fetch('global_data.json');
                const json = await res.json();
                
                globalData = json.records;
                document.getElementById('lastUpdated').innerText = "DATA: " + new Date(json.last_updated).toISOString().split('T')[0];

                // Populate Dropdowns
                const sorted = [...globalData].sort((a,b) => a.country.localeCompare(b.country));
                const selA = document.getElementById('countryA');
                const selB = document.getElementById('countryB');
                
                sorted.forEach(c => {
                    selA.add(new Option(c.country, c.code));
                    selB.add(new Option(c.country, c.code));
                });

                // Set Smart Defaults
                selA.value = sorted.find(c => c.country === "United States")?.code || sorted[0].code;
                selB.value = sorted.find(c => c.country === "China")?.code || sorted[1].code;

                updateComparison();
                switchChart('energy'); // Default view

            } catch (e) {
                console.error(e);
            }
        }

        function updateComparison() {
            const codeA = document.getElementById('countryA').value;
            const codeB = document.getElementById('countryB').value;
            
            const dataA = globalData.find(c => c.code === codeA);
            const dataB = globalData.find(c => c.code === codeB);

            if(!dataA || !dataB) return;

            // Generate the 3-Row Comparison Card
            const metrics = [
                { key: 'energy', name: 'Energy Consumption', unit: 'kg', color: 'bg-emerald-500' },
                { key: 'co2', name: 'Carbon Emissions', unit: 't', color: 'bg-amber-500' },
                { key: 'gdp', name: 'Economic Output', unit: '$', color: 'bg-blue-500' }
            ];

            let html = `<div class="grid grid-cols-3 gap-4 text-center mb-4 border-b border-slate-700 pb-4">
                            <div class="text-xl font-bold text-white">${dataA.country}</div>
                            <div class="text-xs text-slate-500 font-mono pt-2">VS</div>
                            <div class="text-xl font-bold text-white">${dataB.country}</div>
                        </div>`;

            metrics.forEach(m => {
                const valA = dataA[m.key];
                const valB = dataB[m.key];
                const max = Math.max(valA, valB) * 1.2; // Scale factor
                
                html += `
                <div class="mb-5">
                    <div class="flex justify-between text-xs text-slate-400 mb-1">
                        <span>${valA.toLocaleString()} ${m.unit}</span>
                        <span class="font-bold text-slate-200">${m.name}</span>
                        <span>${valB.toLocaleString()} ${m.unit}</span>
                    </div>
                    <div class="flex h-2 bg-slate-800 rounded-full overflow-hidden">
                        <div class="flex justify-end w-1/2 pr-1 border-r border-slate-900">
                            <div class="${m.color} rounded-l-full opacity-80" style="width: ${(valA/max)*100}%"></div>
                        </div>
                        <div class="flex justify-start w-1/2 pl-1">
                            <div class="${m.color} rounded-r-full" style="width: ${(valB/max)*100}%"></div>
                        </div>
                    </div>
                </div>`;
            });

            document.getElementById('scorecard').innerHTML = html;
        }

        function switchChart(metric) {
            // Update Buttons
            ['energy', 'co2', 'gdp'].forEach(m => {
                const btn = document.getElementById('btn-' + m);
                if(m === metric) {
                    btn.className = "px-4 py-1.5 text-xs font-medium rounded-md text-white bg-slate-700 shadow-sm transition-all";
                } else {
                    btn.className = "px-4 py-1.5 text-xs font-medium rounded-md text-slate-400 hover:text-white transition-all";
                }
            });

            // Prepare Data (Top 20 by selected metric)
            const sorted = [...globalData].sort((a,b) => b[metric] - a[metric]).slice(0, 20);

            const ctx = document.getElementById('mainChart').getContext('2d');
            
            if(chartInstance) chartInstance.destroy();

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sorted.map(d => d.country),
                    datasets: [{
                        label: THEME[metric].label,
                        data: sorted.map(d => d[metric]),
                        backgroundColor: THEME[metric].color,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: '#1e293b' }, ticks: { color: '#94a3b8' } },
                        x: { grid: { display: false }, ticks: { color: '#94a3b8' } }
                    }
                }
            });
        }

        init();
    </script>
</body>
</html>
